# [4회차] System Call

# 시스템 콜이란

운영체제가 제공하는 서비스를 사용하기 위한 프로그래밍 인터페이스

- 사용자 애플리케이션은 User Mode에서 실행
- 운영체제가 제공하는 서비스는 Kernel Mode
- 접근하기 위해선 System Call을 통해야만 한다

### 사용자 모드(User Mode)

접근할 수 있는 메모리 영역이 사용자에게 허용된 정도로 제한되어 있고, 하드웨어에 직접적으로 접근 불가

### 커널 모드(Kernel Mode)

모든 시스템 메모리와, CPU Instruction에 접근 가능하고, 하드웨어 직접적으로 접근 가능

## 시스템 콜 처리 과정

![Untitled](%5B4%E1%84%92%E1%85%AC%E1%84%8E%E1%85%A1%5D%20System%20Call%20d2888857b76947d7b13844434f951a3f/Untitled.png)

1. 사용자 프로세스가 시스템 콜 호출(커널 모드 진입)
2. 커널은 내부적으로 시스템 콜 구분하기 위해서 기능별로 고유번호 할당하고 그 번호에 해당하는 제어 루틴을 정의 해놨음
3. 커널은 요청받은 시스템 콜에 대응하는 고유번호 확인하고 그에 맞는 서비스 루틴 호출함
4. 커널은 서비스 루틴 처리하고 사용자 모드로 전환

## 왜 시스템 콜이 필요한건데?

사용자와 운영체제는 시스템 자원을 공유.

사용자에게 제한을 두지 않으면 사용자가 메모리 내의 주요 운영체제 자원을 망가뜨릴 위험이 생김

그래서, 사용자의 시스템 자원 접근을 제한하는 보호 장치가 필요한데

이 보호 장치 역할을 System Call이 함

## 시스템 콜 종류

### 프로세스제어

- 끝내기(exit), 중지 (abort)
- 적재(load), 실행(execute)
- 프로세스 생성(create process) - fork
- 프로세스 속성 획득과 속성 설정
- 시간 대기 (wait time)
- 사건 대기 (wait event)
- 사건을 알림 (signal event)
- 메모리 할당 및 해제

### 파일 조작

- 파일 생성 / 삭제 (create, delete)
- 파일 열기 / 닫기 / 읽기 / 쓰기 (open, close, read, wirte)
- 파일 위치 변경 (reposition)
- 파일 속성 획득 및 설정 (get file attribute, set file attribute)

### 장치 관리

- 하드웨어의 제어와 상태 정보를 얻음 (ioctl)
- 장치를 요구(request device), 장치를 방출 (relese device)
- 장치 읽기 (read), 쓰기(write), 위치 변경
- 장치 속성 획득 및 설정
- 장치의 논리적 부착 및 분리

### 정보 유지

- 시간과 날짜의 설정과 획득 (time)
- 시스템 데이터의 설정과 획득 (date)
- 프로세스 파일, 장치 속성의 획득 및 설정

### 통신

- 통신 연결의 생성, 제거
- 메시지의 송신, 수신
- 상태 정보 전달
- 원격 장치의 부착 및 분리

### 보호

• 권한 관리

## 시스템 콜의 작동방식

![Untitled](%5B4%E1%84%92%E1%85%AC%E1%84%8E%E1%85%A1%5D%20System%20Call%20d2888857b76947d7b13844434f951a3f/Untitled%201.png)

1. **라이브러리 함수(printf)를 호출**한다.
2. 라이브러리 함수 내부에서 **시스템 콜(write)를 호출**한다.
3. 해당 **시스템 콜의 인덱스(4)**를 CPU 레지스터에 **저장**한다.
4. 0x80 **인터럽트를 발생**시킨다.(**커널 모드로 전환**)
5. IDT(Interrupt Descriptor Table)를 참조하여 **system_call()을 호출**한다.
6. 이때 3에서 **저장한 인덱스**를 system_call() 함수 내에 **전달**한다.
7. sys_call_table을 참조해 해당 인덱스에 맞는 **기능(sys_write)을 호출**한다.
8. 수행이 모두 **끝나면 사용자 모드로 전환**된다.
